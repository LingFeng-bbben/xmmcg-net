# Django Admin 功能快速参考卡片

## 🎯 三步快速上手

### 1️⃣ 创建谱面竞标轮次
```
Admin → 竞标轮次 → Actions: "快速创建谱面竞标轮次" → Go
                          ↓
                    ✓ 自动创建新轮次
                    ✓ 自动筛选半成品谱面
```

### 2️⃣ 用户竞标（用户在前端操作）
```
用户 → 前端竞标页面 → 选择谱面 → 输入金额 → 提交竞标
```

### 3️⃣ 分配竞标
```
Admin → 竞标轮次 → 选中新轮次 → Actions: "分配选中的竞标轮次" → Go
                                      ↓
                              ✓ 按出价排序
                              ✓ 分配谱面给用户
                              ✓ 轮次状态变为已完成
```

---

## 📊 Admin 界面导航

### 竞标轮次 (BiddingRound)
**URL**: `/admin/songs/biddinground/`

**列表显示**：
| 字段 | 说明 |
|------|------|
| name | 轮次名称 |
| bidding_type | 竞标类型（歌曲/谱面） |
| competition_phase | 关联的比赛阶段 |
| status | 轮次状态 |
| **可用目标数** | ⭐ 新增：显示可竞标数量 |

**Bulk Actions**：
- ⭐ **快速创建谱面竞标轮次** - 一键创建 + 自动筛选
- 分配选中的竞标轮次 - 执行分配算法

### 竞标 (Bid)
**URL**: `/admin/songs/bid/`

**列表显示**：
- 竞标轮次
- 竞标类型
- 用户
- 竞标目标（歌曲或谱面）
- 出价金额
- 是否 drop
- 创建时间

### 竞标分配结果 (BidResult)
**URL**: `/admin/songs/bidresult/`

**列表显示**：
- 竞标轮次
- 竞标类型
- 分配的目标（歌曲或谱面）
- 中标用户
- 出价金额
- 分配类型（竞标获胜/随机分配）
- 分配时间

### 谱面 (Chart)
**URL**: `/admin/songs/chart/`

**列表显示**：
| 字段 | 说明 |
|------|------|
| id | 谱面 ID |
| user | 创建者 |
| song | 对应歌曲 |
| status | 谱面状态（⭐ 重点：半成品） |
| is_part_one | 是否为第一部分 |
| **designer** | ⭐ 新增：设计者名义 |
| review_count | 评分数 |
| average_score | 平均分 |
| created_at | 创建时间 |

**Bulk Actions**：
- ⭐ 查看可竞标的谱面 - 显示当前半成品数

**状态筛选器**：
- **半成品** (`part_submitted`) ← 重点关注这个
- 完稿 (`final_submitted`)
- 评分中 (`under_review`)
- 已评分 (`reviewed`)

---

## ⚡ 常用快速操作

### 查看有多少个半成品谱面可竞标
```
1. 进入 谱面 列表
2. 点击 Status 筛选器
3. 选择 "半成品"
4. 查看列表数量 = 可竞标的谱面数
```

### 创建新的谱面竞标轮次
```
1. 进入 竞标轮次 列表
2. 点击页面上方 Actions 下拉菜单
3. 选择 "快速创建谱面竞标轮次..."
4. 点击 Go
5. 看到成功消息显示谱面数量
```

### 分配已收集的竞标
```
1. 进入 竞标轮次 列表
2. 勾选要分配的轮次（通常是最新创建的）
3. 点击 Actions 下拉菜单
4. 选择 "分配选中的竞标轮次"
5. 点击 Go
6. 看到成功消息
```

### 查看谁竞标了哪些谱面
```
1. 进入 竞标 列表
2. 使用上方筛选器筛选轮次
3. 查看列表显示所有竞标记录
```

### 查看分配结果
```
1. 进入 竞标分配结果 列表
2. 使用上方筛选器筛选轮次
3. 查看每个用户获得了什么谱面
```

### 查看某个用户的中标谱面
```
1. 进入 竞标分配结果 列表
2. 在搜索框输入用户名
3. 点击搜索
4. 查看该用户所有中标的谱面
```

---

## 🎨 UI 布局提示

### BiddingRound 列表顶部
```
┌─────────────────────────────────────────────────────┐
│ 搜索框 [搜索轮次名称]  |  Actions ▼  |  查看 ▼    │
│                                                   │
│ 筛选器:  Bidding type ▼  Status ▼  Phase ▼ ...   │
└─────────────────────────────────────────────────────┘

Actions 下拉菜单内容:
├─ ⭐ 快速创建谱面竞标轮次（自动筛选半成品谱面）
└─ 分配选中的竞标轮次
```

### Chart 列表顶部
```
┌─────────────────────────────────────────────────────┐
│ 搜索框 [搜索用户名/歌曲/设计者]  |  Actions ▼    │
│                                                   │
│ 筛选器:  Status ▼  Is Part One ▼  Phase ▼ ...    │
│         ↑
│         重点：选择 "半成品" 查看可竞标谱面
└─────────────────────────────────────────────────────┘

Actions 下拉菜单内容:
└─ ⭐ 查看可竞标的谱面 (显示当前可竞标数)
```

---

## 📈 数据流示意

```
第一阶段结束
    ↓
有 8 个 part_submitted 谱面
    ↓
Admin 点击 "快速创建谱面竞标轮次"
    ↓
✓ 新轮次创建: "第二轮竞标 - 谱面完成"
✓ 轮次类型: chart
✓ 可竞标目标: 8 个半成品谱面
    ↓
用户通过前端竞标 (API 调用)
    ↓
Admin 进入 竞标 列表检查
    ↓
Admin 点击 "分配选中的竞标轮次"
    ↓
✓ 竞标被分配
✓ 结果保存到 BidResult
✓ 轮次状态变为 "已完成"
    ↓
用户查看中标结果并开始完成谱面后半部分
```

---

## 🔑 关键字段说明

### BiddingRound (竞标轮次)
- **name**: 轮次名称，默认 "第二轮竞标 - 谱面完成 (YYYY-MM-DD HH:MM)"
- **bidding_type**: 
  - `song` = 歌曲竞标
  - `chart` = 谱面竞标 ⭐
- **status**:
  - `pending` = 待开始
  - `active` = 进行中 (可竞标/分配)
  - `completed` = 已完成 (无法再竞标)
- **可用目标数**: 显示该轮次可竞标的数量
  - 歌曲竞标: 总歌曲数
  - 谱面竞标: 半成品谱面数 ⭐

### Chart (谱面)
- **status**:
  - `part_submitted` = 半成品 ⭐ (可竞标)
  - `final_submitted` = 完稿 (已完成)
  - `under_review` = 评分中
  - `reviewed` = 已评分
- **designer**: 设计者名义（从 maidata.txt 读取）
- **is_part_one**: 是否为第一部分
  - True = 第一部分 (音频+封面+maidata)
  - False = 第二部分 (完成谱面)

---

## ✅ 使用检查清单

使用新功能前确认：
- [ ] 至少有 1 个半成品谱面 (进入 Chart 筛选 Status="半成品" 查看)
- [ ] 新轮次已创建 (进入 BiddingRound 列表查看)
- [ ] 用户已竞标 (进入 Bid 列表查看)
- [ ] 分配已完成 (进入 BidResult 列表查看)
- [ ] 用户已查看结果 (查看用户是否开始完成谱面)

---

## 📱 响应式提示

在手机/平板上使用 Admin：
- 点击 "☰" 菜单按钮打开侧边栏
- 下拉列表和筛选器可能需要横屏查看
- Actions 按钮可能在表格下方

---

## 🆘 快速问题排查

| 问题 | 原因 | 解决 |
|------|------|------|
| 看不到"快速创建..."按钮 | 权限不足 | 需要 Staff 权限 |
| 点击按钮无反应 | 网络延迟 | 等待几秒或刷新 |
| 提示"没有半成品谱面" | 无 part_submitted 谱面 | 确保有第一轮竞标完成的谱面 |
| 分配失败"只能对进行中..." | 轮次已完成 | 创建新的轮次 |
| 找不到新创建的轮次 | 被筛选器隐藏 | 清除所有筛选器或按名称搜索 |

---

## 📞 求助指南

如果需要帮助：
1. 检查上面的 "快速问题排查" 表格
2. 查看本文档前面的 "UI 布局提示"
3. 参考 [ADMIN_QUICK_START.md](./ADMIN_QUICK_START.md) 完整指南
4. 查看 [CHART_BIDDING_SUMMARY.md](./CHART_BIDDING_SUMMARY.md) 功能说明

